name: AI Daily Build Index Site with iFLOW CLI

on:
    push:
        branches: [ main ]
    workflow_dispatch:
    schedule:
      - cron: '0 10 * * 1'  # 每周一 10:00
      - cron: '0 18 * * 5'  # 每周五 18:00

permissions:
  contents: write

jobs:
  iflow:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      - name: 'Gen Site with iFLOW CLI'
        id: iflow
        uses: iflow-ai/iflow-cli-action@main
        with:
          api_key: ${{ secrets.IFLOW_API_KEY }}
          timeout: "3600"
          debug: "true"
          model: "${{ vars.MODEL }}"
          prompt: |
            # 🚨 重要：网站必须生成在 site 目录下 🚨
            
            **生成网站位置要求：**
            - 所有文件必须保存在当前工作目录下的 `site/` 目录中
            - 主页面文件应为 `site/index.html`
            - 确保创建完整的 site 目录结构

            # 角色

            你是一位资深的数字出版设计师，专注于为技术类内容创作清晰、专业、易读的电子刊物。你的设计理念是让信息本身成为主角，通过精心的排版和克制的视觉元素来提升阅读体验。

            ## 任务

            请从以下设计风格中随机选择1种，为 awesome-tech-weekly-zh 项目设计一个技术周刊聚合网站，将 README.json 中的中文技术周刊数据以专业、清晰的杂志式排版呈现。

            **可选设计风格（避免过度装饰，注重可读性）：**

            - 现代简约风格 (Modern Clean) - 推荐
            - 经典印刷风格 (Classic Print)
            - 日式极简风格 (Japanese Minimalism)
            - 斯堪的纳维亚风格 (Scandinavian)
            - 瑞士国际主义风格 (Swiss International Style)
            - 包豪斯风格 (Bauhaus)
            - 构成主义风格 (Constructivism)
            - 极简主义风格 (Minimalist)
            - 优雅复古风格 (Elegant Vintage)
            - 大胆现代风格 (Bold Modern)

            **色彩要求（避免AI感）：**
            - 禁止使用紫色调（包括薰衣草紫、蓝紫、品红等）
            - 优先使用自然、温和的色彩：米色、浅灰、深蓝、墨绿、棕褐色
            - 可使用经典的黑白灰配色
            - 如需强调色，选择温暖的橙色、沉稳的深蓝或自然的绿色
            - 避免荧光色和过于饱和的色彩

            **设计原则：**
            - 内容为王：让技术信息清晰易读，避免装饰元素干扰
            - 克制美学：每个视觉元素都应有其功能目的
            - 专业感：体现技术内容的权威性和可靠性
            - 本土化：适合中文阅读习惯的排版和间距

            **必须包含的元素：**

            - 页面标题：简洁的项目名称展示
            - 周刊分类导航：按技术领域分类的清晰导航
            - 周刊卡片：每个周刊的基本信息（名称、描述、最新文章、更新时间）
            - 统计信息：每个分类的周刊数量统计
            - 回到顶部按钮：固定在右下角，简洁实用
            - 页脚信息：数据来源和生成方式说明

            **技术规范：**

            - 使用HTML5、Font Awesome、Tailwind CSS和必要的JavaScript
            - Font Awesome: <https://lf6-cdn-tos.bytecdntp.com/cdn/expire-100-M/font-awesome/6.0.0/css/all.min.css>
            - Tailwind CSS: <https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/tailwindcss/2.2.19/tailwind.min.css>
            - 中文字体: <https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap>

            **布局与间距要求：**
            - 页面整体使用 `container mx-auto px-4 py-8` 确保与屏幕边缘有充足间距
            - 内容区域使用 `max-w-6xl mx-auto` 提供足够的阅读宽度
            - 卡片与页面四周保持至少 16px (px-4) 的外边距，在大屏幕上增加到 24px (px-6) 或 32px (px-8)
            - 使用响应式设计：`sm:mx-6 md:mx-8 lg:mx-auto` 在不同屏幕尺寸下调整间距
            - 分类标题使用 `mb-6 md:mb-8`，周刊卡片之间使用 `mb-4 md:mb-6`

            **排版要求：**
            - 标题字体优先使用无衬线字体（Noto Sans SC），确保屏幕阅读清晰
            - 正文字号不小于 14px，行高 1.6-1.8 之间
            - 中文内容避免两端对齐，使用左对齐提高可读性
            - 链接使用下划线或颜色区分，避免使用紫色
            - 时间信息使用相对中性的灰色展示

            **交互设计：**
            - 悬停效果要微妙，避免过度动画
            - 卡片悬停时可有轻微的阴影或边框变化
            - 回到顶部按钮在滚动超过一屏后显示
            - 所有交互元素都要有清晰的视觉反馈

            **输出要求：**

            - 🚨 **最重要：所有网站文件必须生成在 site/ 目录下** 🚨
            - 主页面必须命名为 site/index.html
            - 提供一个完整的HTML文件，包含内联的CSS和JavaScript
            - 网站必须是纯静态的，直接嵌入README.json数据，不依赖外部请求
            - 代码结构清晰，CSS组织有序，便于维护和修改
            - 内容以中文为主，保持本土化表达
            - 网站底部需要标明：
              - 数据来源于项目 https://github.com/yeshan333/awesome-tech-weekly-zh
              - 基于 iFLOW CLI 生成

            请以专业出版物的标准，创造一个注重可读性和实用性的技术周刊聚合网站，让用户能够快速找到感兴趣的技术内容，而不是被过度的视觉设计分散注意力。

            ## 注意

            - README.json 文件中，latest_post 和 link 字段的值是 markdown 格式的，需要正确解析和展示

      - name: "Peek the site"
        run: |
          ls -al
          ls -la ./site
      - name: Upload artifact site folder
        uses: actions/upload-artifact@main
        with:
          overwrite: true
          include-hidden-files: true
          name: site
          path: |
            site/
      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 22.16
      - name: Install Netlify CLI
        run: npm install -g netlify-cli
      - name: Deploy AI Gen Site to Netlify
        if: ${{ steps.iflow.outcome == 'success' }}
        run: netlify deploy --prod --site=$NETLIFY_SITE_ID --auth=$NETLIFY_AUTH_TOKEN --dir=site --no-build --message="Deploy AI Gen Site ${{ github.ref }}"
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
